@page "/admin/items"
@using Microsoft.AspNetCore.Authorization

<AuthorizeView Roles="Admin">
    <Authorized>

        <div class="admin-items-container">
            <div class="page-header">
                <div>
                    <h1 class="page-title">Ապրանքների կառավարում</h1>
                </div>
                <button class="btn-add" @onclick="ShowAddModel">+ Ավելացնել նոր ապրանք</button>
            </div>

        

            <div class="items-table">
                <div class="table-header">
                    <span class="col-id">ID</span>
                    <span class="col-name">Անուն</span>
                    <span class="col-price">Գին</span>
                    <span class="col-actions">Գործողություններ</span>
                </div>

                <div class="table-body">
                    <!-- Sample Item Row -->
                    @if (ItemDtos is null)
                    {
                        <p>Loading...</p>
                    }
                    else
                    {
                        @foreach (var Item in ItemDtos)
                        {
                            <div class="table-row">
                                <span class="col-id">@Item.Id</span>
                                <span class="col-name">@Item.Name</span>
                                <span class="col-price">@Item.Amount Դր․</span>
                                <div class="col-actions">
                                    <button class="btn-icon btn-edit" @onclick="() => ShowEditModel(Item.Id)">✏️</button>
                                    <button class="btn-icon btn-delete" @onclick="() => ShowDeleteModel(Item.Id)">🗑️</button>
                                </div>
                            </div>
                        }

                    }
           
                </div>
            </div>

            <!-- Add/Edit Modal -->
            @if (showModel)
            {
                <div class="modal-overlay" @onclick="CloseModel">
                    <div class="modal-content" @onclick:stopPropagation="true">
                        <div class="modal-header">
                            <h2 class="modal-title">@((isEditMode ? "Edit Item" : "Add New Item"))</h2>
                            <button class="btn-close" @onclick="CloseModel">×</button>
                        </div>

                        <div class="modal-body">
                            <div class="form-group">
                                <label class="form-label" >Ապրանքի անուն</label>
                                <input type="text" class="form-input" placeholder="Մուտքագրեք ապրանքի անունը" @bind="_name"/>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Գին (Դր․)</label>
                                    <input type="number" class="form-input" placeholder="0" step="10000" @bind="_price" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Երկիր</label>
                                <input type="text" class="form-input" placeholder="Մուտքագրեք ապրանքի արտադրման երկիրը" @bind="_country" />
                            </div>

                            <div class="form-group">
                                <label class="form-label">Բնութագիր</label>
                                <textarea class="form-textarea" rows="4" placeholder="Մուտքագրեք ապրանքի բնութագիրը" @bind="_description"></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Image URL</label>
                                <InputFile OnChange="HandleImageSelected" />

                                @if (!string.IsNullOrEmpty(_imagePreviewUrl))
                                {
                                    <img src="@_imagePreviewUrl"
                                         alt="Preview"
                                         style="max-width: 200px; margin-top: 10px; border-radius: 8px;" />
                                }
                            </div>
                        </div>

                        <div class="modal-footer">
                            <button class="btn-secondary" @onclick="CloseModel">Չեղարկել</button>
                            <button class="btn-primary" @onclick="SaveItem">@((isEditMode ? "Թարմացնել" : "Ստեղծել"))</button>
                        </div>
                    </div>
                </div>
            }

            <!-- Delete Confirmation Modal -->
            @if (showDeleteModel)
            {
                <div class="modal-overlay" @onclick="CloseDeleteModel">
                    <div class="modal-content modal-small" @onclick:stopPropagation="true">
                        <div class="modal-header">
                            <h2 class="modal-title">Հաստատել ջնջումը</h2>
                            <button class="btn-close" @onclick="CloseDeleteModel">×</button>
                        </div>

                        <div class="modal-body">
                            <p class="delete-message">Համոզվա՞ծ եք, որ ուզում եք ջնջել ապրանքը.</p>
                        </div>

                        <div class="modal-footer">
                            <button class="btn-secondary" @onclick="CloseDeleteModel">Չեղարկել</button>
                            <button class="btn-danger" @onclick="ConfirmDelete">Ջնջել</button>
                        </div>
                    </div>
                </div>
            }
        </div>

    </Authorized>
    <NotAuthorized>
        <RedirectToLogin></RedirectToLogin>
    </NotAuthorized>

</AuthorizeView>
